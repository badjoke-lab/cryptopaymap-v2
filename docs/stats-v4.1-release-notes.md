# Stats v4.1 リリースノート（v4.0 → v4.1）

## 何が変わったか（ユーザー向け）

- Trends（成長推移）が、都度重い集計ではなく**保存済み時系列キューブ**を使って高速・安定化。
- range（24h/7d/30d/all）ごとに粒度（1h/1d/1w）を固定し、見え方を安定化。
- フィルタ指定時、該当キューブがなければ**近いキューブへフォールバック**し、何が落ちたかを明示。
- Top5推移は、期間内合計で凡例を固定してブレを抑制。
- PR #313で Top5 kind が `category` 固定から改善され、`category/country/asset` の文脈に対応。

## 「嘘禁止」の扱い（重要）

- fallback発生時: requested/used/dropped_filters を表示し、別キューブ表示中であることを隠さない。
- cached表示時: 「キャッシュ表示」であることと時刻を明示する。
- stale（更新遅延）: API/cronで stale判定と理由を保持し、運用ログで追跡可能。
- has_data=false: 真っ白にせず、**0ライン＋警告**で「未保存データ」を明示。

## Hobby制約（更新頻度）

- Vercel Cronは **daily 1本**。
- dailyジョブ内で hourly（直近48h再計算）/daily（前日確定）/weekly（月曜のみ）をまとめて実行。
- そのため、更新反映タイミングはリアルタイムではなく、運用上のスケジュールに依存。

## 既知の運用メモ

- 360pxなどモバイル極小幅は、運用時に定期的な目視スモーク確認を推奨。
- stale注記のUI強化は将来PRで改善余地あり。
